#!/usr/bin/env python3
"""
æŠ€èƒ½åˆå§‹åŒ–å™¨ - å¾æ¨¡æ¿å»ºç«‹æ–°æŠ€èƒ½

ç”¨æ³•ï¼š
    init_skill.py <skill-name> --path <path>

ç¯„ä¾‹ï¼š
    init_skill.py my-new-skill --path skills/public
    init_skill.py my-api-helper --path skills/private
    init_skill.py custom-skill --path /custom/location
"""

import sys
from pathlib import Path


SKILL_TEMPLATE = """---
name: {skill_name}
description: [å¾…è¾¦ï¼šå®Œæ•´ä¸”æœ‰ç”¨çš„èªªæ˜ï¼Œæè¿°æ­¤æŠ€èƒ½çš„åŠŸèƒ½åŠä½¿ç”¨æ™‚æ©Ÿã€‚åŒ…å«ä½•æ™‚ä½¿ç”¨æ­¤æŠ€èƒ½ - å…·é«”çš„æƒ…å¢ƒã€æª”æ¡ˆé¡å‹æˆ–è§¸ç™¼ä»»å‹™ã€‚]
---

# {skill_title}

## æ¦‚è¿°

[å¾…è¾¦ï¼šç”¨ 1-2 å¥è©±èªªæ˜æ­¤æŠ€èƒ½èƒ½åšä»€éº¼]

## æŠ€èƒ½çµæ§‹è¦åŠƒ

[å¾…è¾¦ï¼šé¸æ“‡æœ€é©åˆæ­¤æŠ€èƒ½ç›®çš„çš„çµæ§‹ã€‚å¸¸è¦‹æ¨¡å¼ï¼š

**1. å·¥ä½œæµç¨‹å°å‘**ï¼ˆé©åˆå¾ªåºæ¼¸é€²çš„æµç¨‹ï¼‰
- é©ç”¨æ–¼æœ‰æ˜ç¢ºæ­¥é©Ÿçš„ç¨‹åº
- ç¯„ä¾‹ï¼šDOCX æŠ€èƒ½çš„ã€Œå·¥ä½œæµç¨‹æ±ºç­–æ¨¹ã€â†’ã€Œè®€å–ã€â†’ã€Œå»ºç«‹ã€â†’ã€Œç·¨è¼¯ã€
- çµæ§‹ï¼š## æ¦‚è¿° â†’ ## å·¥ä½œæµç¨‹æ±ºç­–æ¨¹ â†’ ## æ­¥é©Ÿ 1 â†’ ## æ­¥é©Ÿ 2...

**2. ä»»å‹™å°å‘**ï¼ˆé©åˆå·¥å…·é›†åˆï¼‰
- é©ç”¨æ–¼æŠ€èƒ½æä¾›ä¸åŒæ“ä½œ/åŠŸèƒ½çš„æƒ…æ³
- ç¯„ä¾‹ï¼šPDF æŠ€èƒ½çš„ã€Œå¿«é€Ÿé–‹å§‹ã€â†’ã€Œåˆä½µ PDFã€â†’ã€Œåˆ†å‰² PDFã€â†’ã€Œæ“·å–æ–‡å­—ã€
- çµæ§‹ï¼š## æ¦‚è¿° â†’ ## å¿«é€Ÿé–‹å§‹ â†’ ## ä»»å‹™é¡åˆ¥ 1 â†’ ## ä»»å‹™é¡åˆ¥ 2...

**3. åƒè€ƒ/æŒ‡å—**ï¼ˆé©åˆæ¨™æº–æˆ–è¦æ ¼ï¼‰
- é©ç”¨æ–¼å“ç‰ŒæŒ‡å—ã€ç¨‹å¼ç¢¼è¦ç¯„æˆ–éœ€æ±‚æ–‡ä»¶
- ç¯„ä¾‹ï¼šå“ç‰Œæ¨£å¼çš„ã€Œå“ç‰ŒæŒ‡å—ã€â†’ã€Œè‰²å½©ã€â†’ã€Œå­—å‹ã€â†’ã€ŒåŠŸèƒ½ã€
- çµæ§‹ï¼š## æ¦‚è¿° â†’ ## æŒ‡å— â†’ ## è¦æ ¼ â†’ ## ä½¿ç”¨æ–¹å¼...

**4. åŠŸèƒ½å°å‘**ï¼ˆé©åˆæ•´åˆç³»çµ±ï¼‰
- é©ç”¨æ–¼æŠ€èƒ½æä¾›å¤šå€‹ç›¸é—œåŠŸèƒ½çš„æƒ…æ³
- ç¯„ä¾‹ï¼šç”¢å“ç®¡ç†çš„ã€Œæ ¸å¿ƒåŠŸèƒ½ã€â†’ ç·¨è™ŸåŠŸèƒ½æ¸…å–®
- çµæ§‹ï¼š## æ¦‚è¿° â†’ ## æ ¸å¿ƒåŠŸèƒ½ â†’ ### 1. åŠŸèƒ½ â†’ ### 2. åŠŸèƒ½...

å¯ä¾éœ€æ±‚æ··åˆæ­é…ä¸åŒæ¨¡å¼ã€‚å¤§å¤šæ•¸æŠ€èƒ½æœƒçµåˆå¤šç¨®æ¨¡å¼ï¼ˆä¾‹å¦‚ï¼šä»¥ä»»å‹™å°å‘é–‹å§‹ï¼Œè¤‡é›œæ“ä½œå†åŠ å…¥å·¥ä½œæµç¨‹ï¼‰ã€‚

å®Œæˆå¾Œè«‹åˆªé™¤æ•´å€‹ã€ŒæŠ€èƒ½çµæ§‹è¦åŠƒã€å€å¡Š - é€™åªæ˜¯æŒ‡å¼•ã€‚]

## [å¾…è¾¦ï¼šæ ¹æ“šé¸æ“‡çš„çµæ§‹æ›¿æ›ç‚ºç¬¬ä¸€å€‹ä¸»è¦å€å¡Š]

[å¾…è¾¦ï¼šåœ¨æ­¤æ–°å¢å…§å®¹ã€‚åƒè€ƒç¾æœ‰æŠ€èƒ½çš„ç¯„ä¾‹ï¼š
- æŠ€è¡“é¡æŠ€èƒ½çš„ç¨‹å¼ç¢¼ç¯„ä¾‹
- è¤‡é›œå·¥ä½œæµç¨‹çš„æ±ºç­–æ¨¹
- åŒ…å«å¯¦éš›ä½¿ç”¨è€…è«‹æ±‚çš„å…·é«”ç¯„ä¾‹
- ä¾éœ€è¦åƒè€ƒ scripts/templates/references]

## è³‡æº

æ­¤æŠ€èƒ½åŒ…å«ç¤ºç¯„è³‡æºç›®éŒ„ï¼Œå±•ç¤ºå¦‚ä½•çµ„ç¹”ä¸åŒé¡å‹çš„ç¶å®šè³‡æºï¼š

### scripts/
å¯ç›´æ¥åŸ·è¡Œçš„ç¨‹å¼ç¢¼ï¼ˆPython/Bash ç­‰ï¼‰ï¼Œç”¨æ–¼åŸ·è¡Œç‰¹å®šæ“ä½œã€‚

**å…¶ä»–æŠ€èƒ½çš„ç¯„ä¾‹ï¼š**
- PDF æŠ€èƒ½ï¼š`fill_fillable_fields.py`ã€`extract_form_field_info.py` - PDF è™•ç†å·¥å…·
- DOCX æŠ€èƒ½ï¼š`document.py`ã€`utilities.py` - æ–‡ä»¶è™•ç† Python æ¨¡çµ„

**é©ç”¨æ–¼ï¼š** Python è…³æœ¬ã€shell è…³æœ¬ï¼Œæˆ–ä»»ä½•åŸ·è¡Œè‡ªå‹•åŒ–ã€è³‡æ–™è™•ç†æˆ–ç‰¹å®šæ“ä½œçš„å¯åŸ·è¡Œç¨‹å¼ç¢¼ã€‚

**æ³¨æ„ï¼š** è…³æœ¬å¯èƒ½åœ¨ä¸è¼‰å…¥ä¸Šä¸‹æ–‡çš„æƒ…æ³ä¸‹åŸ·è¡Œï¼Œä½† Claude ä»å¯è®€å–å®ƒå€‘ä»¥é€²è¡Œä¿®è£œæˆ–ç’°å¢ƒèª¿æ•´ã€‚

### references/
æ–‡ä»¶å’Œåƒè€ƒè³‡æ–™ï¼Œç”¨æ–¼è¼‰å…¥ä¸Šä¸‹æ–‡ä»¥æŒ‡å° Claude çš„æµç¨‹å’Œæ€è€ƒã€‚

**å…¶ä»–æŠ€èƒ½çš„ç¯„ä¾‹ï¼š**
- ç”¢å“ç®¡ç†ï¼š`communication.md`ã€`context_building.md` - è©³ç´°çš„å·¥ä½œæµç¨‹æŒ‡å—
- BigQueryï¼šAPI åƒè€ƒæ–‡ä»¶å’ŒæŸ¥è©¢ç¯„ä¾‹
- è²¡å‹™ï¼šSchema æ–‡ä»¶ã€å…¬å¸æ”¿ç­–

**é©ç”¨æ–¼ï¼š** æ·±å…¥çš„æ–‡ä»¶ã€API åƒè€ƒã€è³‡æ–™åº« schemaã€å®Œæ•´æŒ‡å—ï¼Œæˆ– Claude å·¥ä½œæ™‚æ‡‰åƒè€ƒçš„ä»»ä½•è©³ç´°è³‡è¨Šã€‚

### assets/
ä¸ç”¨æ–¼è¼‰å…¥ä¸Šä¸‹æ–‡ï¼Œè€Œæ˜¯åœ¨ Claude ç”¢å‡ºä¸­ä½¿ç”¨çš„æª”æ¡ˆã€‚

**å…¶ä»–æŠ€èƒ½çš„ç¯„ä¾‹ï¼š**
- å“ç‰Œæ¨£å¼ï¼šPowerPoint ç¯„æœ¬æª”æ¡ˆ (.pptx)ã€æ¨™èªŒæª”æ¡ˆ
- å‰ç«¯å»ºæ§‹å™¨ï¼šHTML/React æ¨£æ¿å°ˆæ¡ˆç›®éŒ„
- å­—å‹ï¼šå­—å‹æª”æ¡ˆ (.ttf, .woff2)

**é©ç”¨æ–¼ï¼š** ç¯„æœ¬ã€æ¨£æ¿ç¨‹å¼ç¢¼ã€æ–‡ä»¶ç¯„æœ¬ã€åœ–ç‰‡ã€åœ–ç¤ºã€å­—å‹ï¼Œæˆ–ä»»ä½•ç”¨æ–¼è¤‡è£½æˆ–åœ¨æœ€çµ‚ç”¢å‡ºä¸­ä½¿ç”¨çš„æª”æ¡ˆã€‚

---

**ä¸éœ€è¦çš„ç›®éŒ„å¯ä»¥åˆªé™¤ã€‚** ä¸¦éæ¯å€‹æŠ€èƒ½éƒ½éœ€è¦é€™ä¸‰ç¨®è³‡æºã€‚
"""

EXAMPLE_SCRIPT = '''#!/usr/bin/env python3
"""
{skill_name} çš„ç¯„ä¾‹è¼”åŠ©è…³æœ¬

é€™æ˜¯ä¸€å€‹å¯ç›´æ¥åŸ·è¡Œçš„ä½”ä½è…³æœ¬ã€‚
è«‹æ›¿æ›ç‚ºå¯¦éš›å¯¦ä½œæˆ–åœ¨ä¸éœ€è¦æ™‚åˆªé™¤ã€‚

å…¶ä»–æŠ€èƒ½çš„å¯¦éš›è…³æœ¬ç¯„ä¾‹ï¼š
- pdf/scripts/fill_fillable_fields.py - å¡«å¯« PDF è¡¨å–®æ¬„ä½
- pdf/scripts/convert_pdf_to_images.py - å°‡ PDF é é¢è½‰æ›ç‚ºåœ–ç‰‡
"""

def main():
    print("é€™æ˜¯ {skill_name} çš„ç¯„ä¾‹è…³æœ¬")
    # å¾…è¾¦ï¼šåœ¨æ­¤æ–°å¢å¯¦éš›è…³æœ¬é‚è¼¯
    # å¯ä»¥æ˜¯è³‡æ–™è™•ç†ã€æª”æ¡ˆè½‰æ›ã€API å‘¼å«ç­‰

if __name__ == "__main__":
    main()
'''

EXAMPLE_REFERENCE = """# {skill_title} åƒè€ƒæ–‡ä»¶

é€™æ˜¯è©³ç´°åƒè€ƒæ–‡ä»¶çš„ä½”ä½æª”æ¡ˆã€‚
è«‹æ›¿æ›ç‚ºå¯¦éš›åƒè€ƒå…§å®¹æˆ–åœ¨ä¸éœ€è¦æ™‚åˆªé™¤ã€‚

å…¶ä»–æŠ€èƒ½çš„å¯¦éš›åƒè€ƒæ–‡ä»¶ç¯„ä¾‹ï¼š
- product-management/references/communication.md - ç‹€æ…‹æ›´æ–°å®Œæ•´æŒ‡å—
- product-management/references/context_building.md - æ·±å…¥äº†è§£å¦‚ä½•æ”¶é›†ä¸Šä¸‹æ–‡
- bigquery/references/ - API åƒè€ƒå’ŒæŸ¥è©¢ç¯„ä¾‹

## ä½•æ™‚éœ€è¦åƒè€ƒæ–‡ä»¶

åƒè€ƒæ–‡ä»¶é©ç”¨æ–¼ï¼š
- å®Œæ•´çš„ API æ–‡ä»¶
- è©³ç´°çš„å·¥ä½œæµç¨‹æŒ‡å—
- è¤‡é›œçš„å¤šæ­¥é©Ÿæµç¨‹
- ä¸»è¦ SKILL.md æ”¾ä¸ä¸‹çš„å…§å®¹
- åƒ…ç‰¹å®šä½¿ç”¨æ¡ˆä¾‹éœ€è¦çš„å…§å®¹

## çµæ§‹å»ºè­°

### API åƒè€ƒç¯„ä¾‹
- æ¦‚è¿°
- èªè­‰
- ç«¯é»èˆ‡ç¯„ä¾‹
- éŒ¯èª¤ä»£ç¢¼
- é€Ÿç‡é™åˆ¶

### å·¥ä½œæµç¨‹æŒ‡å—ç¯„ä¾‹
- å‰ç½®æ¢ä»¶
- æ­¥é©Ÿèªªæ˜
- å¸¸è¦‹æ¨¡å¼
- ç–‘é›£æ’è§£
- æœ€ä½³å¯¦è¸
"""

EXAMPLE_ASSET = """# ç¯„ä¾‹è³‡æºæª”æ¡ˆ

æ­¤ä½”ä½æª”æ¡ˆä»£è¡¨è³‡æºæª”æ¡ˆçš„å­˜æ”¾ä½ç½®ã€‚
è«‹æ›¿æ›ç‚ºå¯¦éš›è³‡æºæª”æ¡ˆï¼ˆç¯„æœ¬ã€åœ–ç‰‡ã€å­—å‹ç­‰ï¼‰æˆ–åœ¨ä¸éœ€è¦æ™‚åˆªé™¤ã€‚

è³‡æºæª”æ¡ˆä¸ç”¨æ–¼è¼‰å…¥ä¸Šä¸‹æ–‡ï¼Œè€Œæ˜¯åœ¨ Claude ç”¢å‡ºä¸­ä½¿ç”¨ã€‚

å…¶ä»–æŠ€èƒ½çš„è³‡æºæª”æ¡ˆç¯„ä¾‹ï¼š
- å“ç‰ŒæŒ‡å—ï¼šlogo.pngã€slides_template.pptx
- å‰ç«¯å»ºæ§‹å™¨ï¼šhello-world/ ç›®éŒ„ï¼Œå« HTML/React æ¨£æ¿
- å­—å‹ï¼šcustom-font.ttfã€font-family.woff2
- è³‡æ–™ï¼šsample_data.csvã€test_dataset.json

## å¸¸è¦‹è³‡æºé¡å‹

- ç¯„æœ¬ï¼š.pptxã€.docxã€æ¨£æ¿ç›®éŒ„
- åœ–ç‰‡ï¼š.pngã€.jpgã€.svgã€.gif
- å­—å‹ï¼š.ttfã€.otfã€.woffã€.woff2
- æ¨£æ¿ç¨‹å¼ç¢¼ï¼šå°ˆæ¡ˆç›®éŒ„ã€èµ·å§‹æª”æ¡ˆ
- åœ–ç¤ºï¼š.icoã€.svg
- è³‡æ–™æª”æ¡ˆï¼š.csvã€.jsonã€.xmlã€.yaml

æ³¨æ„ï¼šé€™æ˜¯æ–‡å­—ä½”ä½æª”ã€‚å¯¦éš›è³‡æºå¯ä»¥æ˜¯ä»»ä½•æª”æ¡ˆé¡å‹ã€‚
"""


def title_case_skill_name(skill_name):
    """å°‡é€£å­—è™Ÿåˆ†éš”çš„æŠ€èƒ½åç¨±è½‰æ›ç‚ºæ¨™é¡Œæ ¼å¼ã€‚"""
    return ' '.join(word.capitalize() for word in skill_name.split('-'))


def init_skill(skill_name, path):
    """
    åˆå§‹åŒ–æ–°çš„æŠ€èƒ½ç›®éŒ„ä¸¦å»ºç«‹æ¨¡æ¿ SKILL.mdã€‚

    åƒæ•¸ï¼š
        skill_name: æŠ€èƒ½åç¨±
        path: æŠ€èƒ½ç›®éŒ„çš„å»ºç«‹è·¯å¾‘

    å›å‚³ï¼š
        å»ºç«‹çš„æŠ€èƒ½ç›®éŒ„è·¯å¾‘ï¼Œç™¼ç”ŸéŒ¯èª¤æ™‚å›å‚³ None
    """
    # æ±ºå®šæŠ€èƒ½ç›®éŒ„è·¯å¾‘
    skill_dir = Path(path).resolve() / skill_name

    # æª¢æŸ¥ç›®éŒ„æ˜¯å¦å·²å­˜åœ¨
    if skill_dir.exists():
        print(f"âŒ éŒ¯èª¤ï¼šæŠ€èƒ½ç›®éŒ„å·²å­˜åœ¨ï¼š{skill_dir}")
        return None

    # å»ºç«‹æŠ€èƒ½ç›®éŒ„
    try:
        skill_dir.mkdir(parents=True, exist_ok=False)
        print(f"âœ… å·²å»ºç«‹æŠ€èƒ½ç›®éŒ„ï¼š{skill_dir}")
    except Exception as e:
        print(f"âŒ å»ºç«‹ç›®éŒ„æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š{e}")
        return None

    # å¾æ¨¡æ¿å»ºç«‹ SKILL.md
    skill_title = title_case_skill_name(skill_name)
    skill_content = SKILL_TEMPLATE.format(
        skill_name=skill_name,
        skill_title=skill_title
    )

    skill_md_path = skill_dir / 'SKILL.md'
    try:
        skill_md_path.write_text(skill_content)
        print("âœ… å·²å»ºç«‹ SKILL.md")
    except Exception as e:
        print(f"âŒ å»ºç«‹ SKILL.md æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š{e}")
        return None

    # å»ºç«‹è³‡æºç›®éŒ„åŠç¯„ä¾‹æª”æ¡ˆ
    try:
        # å»ºç«‹ scripts/ ç›®éŒ„åŠç¯„ä¾‹è…³æœ¬
        scripts_dir = skill_dir / 'scripts'
        scripts_dir.mkdir(exist_ok=True)
        example_script = scripts_dir / 'example.py'
        example_script.write_text(EXAMPLE_SCRIPT.format(skill_name=skill_name))
        example_script.chmod(0o755)
        print("âœ… å·²å»ºç«‹ scripts/example.py")

        # å»ºç«‹ references/ ç›®éŒ„åŠç¯„ä¾‹åƒè€ƒæ–‡ä»¶
        references_dir = skill_dir / 'references'
        references_dir.mkdir(exist_ok=True)
        example_reference = references_dir / 'api_reference.md'
        example_reference.write_text(EXAMPLE_REFERENCE.format(skill_title=skill_title))
        print("âœ… å·²å»ºç«‹ references/api_reference.md")

        # å»ºç«‹ assets/ ç›®éŒ„åŠç¯„ä¾‹è³‡æºä½”ä½æª”
        assets_dir = skill_dir / 'assets'
        assets_dir.mkdir(exist_ok=True)
        example_asset = assets_dir / 'example_asset.txt'
        example_asset.write_text(EXAMPLE_ASSET)
        print("âœ… å·²å»ºç«‹ assets/example_asset.txt")
    except Exception as e:
        print(f"âŒ å»ºç«‹è³‡æºç›®éŒ„æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š{e}")
        return None

    # é¡¯ç¤ºå¾ŒçºŒæ­¥é©Ÿ
    print(f"\nâœ… æŠ€èƒ½ '{skill_name}' å·²æˆåŠŸåˆå§‹åŒ–æ–¼ {skill_dir}")
    print("\nå¾ŒçºŒæ­¥é©Ÿï¼š")
    print("1. ç·¨è¼¯ SKILL.md å®Œæˆå¾…è¾¦é …ç›®ä¸¦æ›´æ–°èªªæ˜")
    print("2. è‡ªè¨‚æˆ–åˆªé™¤ scripts/ã€references/ å’Œ assets/ ä¸­çš„ç¯„ä¾‹æª”æ¡ˆ")
    print("3. æº–å‚™å¥½å¾ŒåŸ·è¡Œé©—è­‰å™¨æª¢æŸ¥æŠ€èƒ½çµæ§‹")

    return skill_dir


def main():
    if len(sys.argv) < 4 or sys.argv[2] != '--path':
        print("ç”¨æ³•ï¼šinit_skill.py <skill-name> --path <path>")
        print("\næŠ€èƒ½åç¨±è¦æ±‚ï¼š")
        print("  - é€£å­—è™Ÿæ ¼å¼è­˜åˆ¥ç¢¼ï¼ˆä¾‹å¦‚ï¼š'data-analyzer'ï¼‰")
        print("  - åƒ…é™å°å¯«å­—æ¯ã€æ•¸å­—å’Œé€£å­—è™Ÿ")
        print("  - æœ€å¤š 40 å€‹å­—å…ƒ")
        print("  - å¿…é ˆèˆ‡ç›®éŒ„åç¨±å®Œå…¨ç›¸åŒ")
        print("\nç¯„ä¾‹ï¼š")
        print("  init_skill.py my-new-skill --path skills/public")
        print("  init_skill.py my-api-helper --path skills/private")
        print("  init_skill.py custom-skill --path /custom/location")
        sys.exit(1)

    skill_name = sys.argv[1]
    path = sys.argv[3]

    print(f"ğŸš€ æ­£åœ¨åˆå§‹åŒ–æŠ€èƒ½ï¼š{skill_name}")
    print(f"   ä½ç½®ï¼š{path}")
    print()

    result = init_skill(skill_name, path)

    if result:
        sys.exit(0)
    else:
        sys.exit(1)


if __name__ == "__main__":
    main()
